import{k as E,r as y,j as G,$ as q,c as b,o as x,a as u,x as _,u as d,z as k,B as R,J as P,K as H,f as w,d as W,g as X,n as Y,P as a,D as Z,E as B}from"./index-Cn06d1yw.js";import{v as ee,_ as h,f as te,a as se,u as ae,b as re,c as ne,d as ce,e as le,g as ue}from"./SearchField-BxEEmBNo.js";import{R as f,u as ie}from"./useToast-C1hprg7S.js";import"./vue-query.util-evjr9S1L.js";import{a as V}from"./admin.service-Cu4hN8Kp.js";import{_ as T}from"./Button-lUNRF2yf.js";import{_ as oe}from"./Icon-CBsTllnE.js";import{a as de,b as me,_ as pe}from"./PopoverContent-NpXA2lUG.js";import{T as g}from"./CustomToast.vue_vue_type_style_index_0_scoped_d3a5404c_lang-BP7u1LgJ.js";import{_ as fe}from"./DialogComponent-Cu7kKC4a.js";import"./eye-CLyunyjW.js";import"./error-input-DKRf7V6d.js";import"./icon-back-BpU1-qJd.js";const ge={class:"flex justify-center items-center space-x-2"},_e=["value","onClick"],he={class:"flex justify-end"},ye={__name:"ColumnHeaderFilter",props:{column:Object,title:String},setup(p){const r=E(),n=y(""),e=y(Object.keys(f).map(c=>({value:f[c],id:f[c],checked:!0})));G(()=>{var c;(c=r.query)!=null&&c.filterStatuses||(n.value=Object.values(f),q.replace({query:{...r.query,filterStatuses:Object.values(f).join(",")}}))});const i=c=>{let l=n.value;l.includes(c)?l=l.filter(t=>t!==c):l.push(c),n.value=l,e.value=e.value.map(t=>({...t,checked:n.value.includes(t.id)})),q.replace({name:r.name,query:{...r.query,filterStatuses:l.length?l.toString():""}})};return(c,l)=>(x(),b("div",ge,[u(d(pe),null,{default:_(()=>[u(d(de),null,{default:_(()=>[u(d(T),{variant:"ghost",size:"sm",class:"-ml-3 h-8 data-[state=open]:bg-accent"},{default:_(()=>[u(g,{type:"primary",class:"text-secondary"},{default:_(()=>[k(R(p.title),1)]),_:1}),u(oe,{icon:"arrow-down",size:24})]),_:1})]),_:1}),u(d(me),{class:"w-fit"},{default:_(()=>[(x(!0),b(P,null,H(e.value,t=>(x(),b("div",{value:t.value,key:t.id,class:"grid grid-cols-2 w-[170px] h-10 items-center",onClick:$=>i(t.id)},[u(g,{class:"whitespace-nowrap"},{default:_(()=>[k(R(t.value),1)]),_:2},1024),w("div",he,[u(ee,{checked:t.checked,class:"text-right"},null,8,["checked"])])],8,_e))),128))]),_:1})]),_:1})]))}},ve={__name:"RequestStatus",props:{status:{type:String,required:!0}},setup(p){const r={[f.APPROVED]:{type:"success",content:"Approved"},[f.PENDING]:{type:"warning",content:"Pending"},[f.REJECTED]:{type:"error",content:"Rejected"}};return(n,e)=>(x(),W(T,{class:Y([[r[p.status].type==="success"?"bg-success":r[p.status].type==="warning"?"bg-warning":"bg-error"],"w-[88px] h-6 flex justify-center items-center cursor-default"])},{default:_(()=>[u(g,X(r[p.status],{class:"text-xs text-background"}),null,16)]),_:1},8,["class"]))}},xe=({setOpenPopup:p,setId:r,handleApprove:n})=>[{accessorKey:"userName",header:({column:e})=>a(h,{column:e,title:"Name"}),cell:({row:e})=>a(g,{truncated:!0,type:"primary"},()=>{var i;return((i=e.original.user_request)==null?void 0:i.username)||"N/A"}),enableSorting:!0,cellClass:"max-w-[300px] truncate"},{accessorKey:"userEmail",header:({column:e})=>a(h,{column:e,title:"Email"}),cell:({row:e})=>a(g,{truncated:!0,type:"primary"},()=>{var i;return((i=e.original.user_request)==null?void 0:i.user_email)||"N/A"}),enableSorting:!1,cellClass:"max-w-[300px] truncate"},{accessorKey:"map_id",header:({column:e})=>a(h,{column:e,title:"Map ID"}),cell:({row:e})=>a(g,{truncated:!0,type:"primary"},()=>e.getValue("map_id")),enableSorting:!1,cellClass:"w-[150px]"},{accessorKey:"message",header:({column:e})=>a(h,{column:e,title:"Message"}),cell:({row:e})=>a(g,{truncated:!0,type:"primary"},()=>e.getValue("message")),enableSorting:!1,cellClass:"w-[350px] truncate"},{accessorKey:"request_status",header:({column:e})=>a(ye,{column:e,title:"STATUS",class:"text-center w-auto"}),cell:({row:e})=>a(ve,{status:e.getValue("request_status")}),align:"center",headerAlign:"center",enableSorting:!1},{accessorKey:"created_at",header:({column:e})=>a(h,{column:e,title:"Create Date"}),cell:({row:e})=>a(g,{truncated:!0},()=>te(e.getValue("created_at"),"dd MMM yyyy")),enableSorting:!0},{accessorKey:"actions",header:({column:e})=>a(h,{column:e,title:"Actions"}),cellClass:"w-[47px]",cell:({row:e})=>a(se,{actions:["approve","reject"],setOpenPopup:p,handleApprove:n,setId:()=>r(e.original)}),enableSorting:!1}],Se={class:"mt-[32px]"},be={class:"flex justify-end items-center"},De={__name:"index",setup(p){const r=y(""),n=y(!1),e=y(null),i=ie(),c=E(),{sort:l,sortParams:t}=ae({isMultiSort:!1,sortBy:"createdAt",orderBy:"desc"}),{search:$,searchBy:D}=re({search:"",searchBy:"name"}),{pagination:j,page:S,perPage:N}=ne({writeQuery:!0}),A=y($.value),K=Z(()=>{var o,s;return{page:S,take:N,sort:(o=t==null?void 0:t.value)==null?void 0:o.orderBy,sortBy:(s=t==null?void 0:t.value)==null?void 0:s.sortBy,search:A,searchBy:D.value}}),{data:U,isFetching:M,refetch:F}=V.getAccessRequests(K),I=V.updateAccessRequest(),{items:O}=ce(U,{pagination:j}),z=o=>{e.value=o},L=o=>{o==="confirm"&&(n.value=!0)},C=o=>{var m;const s=(m=e==null?void 0:e.value)==null?void 0:m.id;if(!s)return i.danger("Invalid ID. Unable to approve request.");I.mutateAsync({bodyPayload:{action:o},pathParams:{id:s}}).then(v=>{i.success(v.message||"User request has been successfully updated"),n.value=!1,F()}).catch(v=>{i.danger((v==null?void 0:v.error)||"Failed to approve user request")})},J=xe({setOpenPopup:L,setId:z,handleApprove:C}),Q=o=>{const s=o.target.value;q.replace({path:"/admin/users",query:{...c.query,page:1,search:s}}),A.value=s};return(o,s)=>(x(),b(P,null,[w("div",Se,[w("div",be,[u(le,{placeholder:"Search users name",handleSearch:Q})]),u(ue,{page:d(S),"onUpdate:page":s[0]||(s[0]=m=>B(S)?S.value=m:null),sort:d(l),"onUpdate:sort":s[1]||(s[1]=m=>B(l)?l.value=m:null),searching:!!r.value,"enable-hover-on-row":!1,"header-height":58,"enable-row-selection":!1,"table-height":"100vh - 350px","item-name":"member",data:d(O),columns:d(J),pagination:d(j),"default-rows-per-page":15,isLoading:d(M)},null,8,["page","sort","searching","data","columns","pagination","isLoading"])]),u(fe,{modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=m=>n.value=m),title:"Reject this request?",description:"Are you sure you want to reject this user request?",onConfirm:s[3]||(s[3]=m=>C("rejected"))},null,8,["modelValue"])],64))}};export{De as default};
